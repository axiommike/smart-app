import Ember from "ember";
import EditableMixin from "../mixins/editable";

export default Ember.Component.extend(EditableMixin, {
	tagName: "historical-employment",
	classNameBindings: ["employment.isCurrent", ":historical-employment"],
	attributeBindings: ["data-tenure"],
	"data-tenure": Ember.computed.alias("employment.tenureTotalYears"),
	employment: null,
	durationEnabled: false,
	needsNOA: Ember.computed.or("employment.isSelfEmployed", "employment.isCommission"),
	noaYears: 2,
	noaValues: Ember.computed("noaYears", function() {
		let noas = Ember.A(),
			lastYear = new Date().getFullYear() - 1;
		for (let year = 0; year < this.get("noaYears"); year++) {
			noas.pushObject({year: lastYear - year, value: 0});
		}
		return noas;
	}),
	noaYearsChanged: function() {
		console.log(`Years values changed`);
		// income generated by noas should be average of last 2 years, or the last year if the most current year is lower than the one before it
		if (this.get("noaValues.firstObject.value") > this.get("noaValues.lastObject.value")) {
			this.set("employment.income.value", this.get("noaValues.lastObject.value"));
		}
		else { // get the average of all noa years
			let average = (this.get("noaValues").reduce(function(previousValue, year) {
				return previousValue + parseInt(year.value);
			}, 0)) / this.get("noaValues.length");
			this.set("employment.income.value", average);
		}
	}.observes("noaValues.@each.value"),
	employmentTypes: [
		{label: "Full-Time", value: "full-time"},
		{label: "Part-Time", value: "part-time"},
		{label: "Self-Employed", value: "self-employed"},
		{label: "Pension", value: "pension"},
		{label: "Retired", value: "retired"},
		{label: "Student", value: "student"},
		{label: "Other", value: "other"} /* Seasonal, etc. */
	],
	businessTypes: [
		{label: "Incorporated", value: "incorporated"},
		{label: "Partnership", value: "partnership"},
		{label: "Sole Proprietorship", value: "sole-propriety"}
	],
	paymentFrequencies: [
		{label: "Hourly", value: "hourly"},
		{label: "Salary", value: "salary"},
		{label: "Commission", value: "commission"},
		{label: "Commission + Salary", value: "commission-salary"},
		{label: "Commission + Hourly", value: "commission-hourly"}
	],
	onRemove: null,
	actions: {
		remove: function() {
			this.sendAction("onRemove", this.get("employment"));
		}
	}
});
